<!DOCTYPE html>
<html lang="en">
<head>
    <title>Exchange Rates USD/BYN EUR/BYN BYN/PLN</title>
    <meta charset="utf-8"/>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
          integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <style>
        /* Styling the spinner */
        .spinner-xyz {
            animation: 1s linear 0s normal none infinite running rot;
            -webkit-animation: 1s linear 0s normal none infinite running rot;
        }

        @-webkit-keyframes rot {
            0% {
                transform: rotate(0deg);
            }
            25% {
                transform: rotate(90deg);
            }
            50% {
                transform: rotate(180deg);
            }
            75% {
                transform: rotate(270deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        body {
            font-size: 2rem;
            background-color: #343a40;
        }

        table th {
            cursor: pointer;
        }
    </style>
</head>
<body>

<table class="table table-striped table-info table-hover" id="sortTable">
    <thead class="thead-dark">
    <tr class="bg-info">
        <th scope="col">BANK</th>
        <th scope="col" onclick="sortTable(0)">USD/BYN</th>
        <th scope="col" onclick="sortTable(1)">EUR/BYN</th>
        <th scope="col" onclick="sortTable(2)">BYN/PLN</th>
        <th scope="col">UPDATE</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <th scope="row"><a class="badge badge-info" href="https://www.bsb.by/obmen-valyut">BSB</a></th>
        <td>
            <section id="print-BSB-USD"></section>
        </td>
        <td>
            <section id="print-BSB-EUR"></section>
        </td>
        <td>
            <section id="print-BSB-PLN"></section>
        </td>
        <td>
            <button id="btnLoadingBSB" style="display: none;" class="btn btn-info" type="button" disabled>
                <section class="spinner-xyz">
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </section>
                <span class="sr-only">Loading...</span>
            </button>
            <button id="btnUpdateBSB" class="btn btn-info" type="button" onclick="requestPostBSB()">
                <div>
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </div>
                <span class="sr-only">Update</span>
            </button>
    </tr>
    <tr>
        <th scope="row"><a class="badge badge-info" href="https://bnb.by/kursy-valyut/imbank/">BNB</a></th>
        <td>
            <section id="print-BNB-USD"></section>
        </td>
        <td>
            <section id="print-BNB-EUR"></section>
        </td>
        <td>
            <section id="print-BNB-PLN"></section>
        </td>
        <td>
            <button id="btnLoadingBNB" style="display: none;" class="btn btn-info" type="button" disabled>
                <section class="spinner-xyz">
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </section>
                <span class="sr-only">Loading...</span>
            </button>
            <button id="btnUpdateBNB" class="btn btn-info" type="button" onclick="requestPostBNB()">
                <div>
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </div>
                <span class="sr-only">Update</span>
            </button>
        </td>
    </tr>
    <tr>
        <th scope="row"><a class="badge badge-info" href="https://www.alfabank.by/exchange/digital/">Alfa</a></th>
        <td>
            <section id="print-Alfa-USD"></section>
        </td>
        <td>
            <section id="print-Alfa-EUR"></section>
        </td>
        <td>
            <section id="print-Alfa-PLN"></section>
        </td>
        <td>
            <button id="btnLoadingAlfa" style="display: none;" class="btn btn-info" type="button" disabled>
                <section class="spinner-xyz">
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </section>
                <span class="sr-only">Loading...</span>
            </button>
            <button id="btnUpdateAlfa" class="btn btn-info" type="button" onclick="requestPostAlfa()">
                <div>
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </div>
                <span class="sr-only">Update</span>
            </button>
    </tr>
    <tr>
        <th scope="row"><a class="badge badge-info" href="https://www.paritetbank.by/private/rates/">Paritet</a></th>
        <td>
            <section id="print-Paritet-USD"></section>
        </td>
        <td>
            <section id="print-Paritet-EUR"></section>
        </td>
        <td>
            <section id="print-Paritet-PLN"></section>
        </td>
        <td>
            <button id="btnLoadingParitet" style="display: none;" class="btn btn-info" type="button" disabled>
                <section class="spinner-xyz">
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </section>
                <span class="sr-only">Loading...</span>
            </button>
            <button id="btnUpdateParitet" class="btn btn-info" type="button" onclick="requestPostParitet()">
                <div>
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </div>
                <span class="sr-only">Update</span>
            </button>
    </tr>
    <tr>
        <th scope="row"><a class="badge badge-info" href="https://belgazprombank.by/about/kursi_valjut/">BGPB</a></th>
        <td>
            <section id="print-BGPB-USD"></section>
        </td>
        <td>
            <section id="print-BGPB-EUR"></section>
        </td>
        <td>
            <section id="print-BGPB-PLN"></section>
        </td>
        <td>
            <button id="btnLoadingBGPB" style="display: none;" class="btn btn-info" type="button" disabled>
                <section class="spinner-xyz">
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </section>
                <span class="sr-only">Loading...</span>
            </button>
            <button id="btnUpdateBGPB" class="btn btn-info" type="button" onclick="requestPostBGPB()">
                <div>
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </div>
                <span class="sr-only">Update</span>
            </button>
    </tr>
    <tr>
        <th scope="row"><a class="badge badge-info" href="https://www.mtbank.by/courses/cards/">MTB</a></th>
        <td>
            <section id="print-MTB-USD"></section>
        </td>
        <td>
            <section id="print-MTB-EUR"></section>
        </td>
        <td>
            <section id="print-MTB-PLN"></section>
        </td>
        <td>
            <button id="btnLoadingMTB" style="display: none;" class="btn btn-info" type="button" disabled>
                <section class="spinner-xyz">
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </section>
                <span class="sr-only">Loading...</span>
            </button>
            <button id="btnUpdateMTB" class="btn btn-info" type="button" onclick="requestPostMTB()">
                <div>
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </div>
                <span class="sr-only">Update</span>
            </button>
    </tr>
    <tr>
        <th scope="row"><a class="badge badge-info" href="https://www.mtbank.by/courses/cards/">PayOkay</a></th>
        <td>
            <section id="print-PayOkay-USD"></section>
        </td>
        <td>
            <section id="print-PayOkay-EUR"></section>
        </td>
        <td>
            <section id="print-PayOkay-PLN"></section>
        </td>
        <td>
            <button id="btnLoadingPayOkay" style="display: none;" class="btn btn-info" type="button" disabled>
                <section class="spinner-xyz">
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </section>
                <span class="sr-only">Loading...</span>
            </button>
            <button id="btnUpdatePayOkay" class="btn btn-info" type="button" onclick="requestPostPayOkay()">
                <div>
                    <span class="bi bi-arrow-repeat" role="status" aria-hidden="true"></span>
                </div>
                <span class="sr-only">Update</span>
            </button>
    </tr>
    </tbody>
</table>

<script>

    const userAgent = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36';

    function requestPostBSB() {
        const btnUpdate = document.getElementById("btnUpdateBSB");
        const btnLoading = document.getElementById("btnLoadingBSB");
        if (!isExist(btnUpdate) && !isExist(btnLoading)) {
            return;
        }

        hideElement(btnUpdate);
        showElement(btnLoading);

        let urlBsb = 'https://mobile.bsb.by/api/v1/free-zone-management/exchange-rates/rates';
        console.log('URL for POST:', urlBsb);

        fetch(urlBsb, {
            body: JSON.stringify({
                'period': Date.parse(new Date().toString()),
                'type': 'CARD'
            }),
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'User-Agent': userAgent
            },
            method: 'POST',
            redirect: 'follow'
        })
            .then(response => {
                response.json()
                    .then(res => {
                        let rates = res['rates'];

                        let rateUSD = rates[0].sellAmount.toFixed(4);
                        let rateEUR = rates[1].sellAmount.toFixed(4);
                        let ratePLN = (1 / rates[6].sellAmount).toFixed(4);

                        document.getElementById("print-BSB-USD").innerText = rateUSD;
                        document.getElementById("print-BSB-EUR").innerText = rateEUR;
                        document.getElementById("print-BSB-PLN").innerText = ratePLN;

                        setBlueColor(btnUpdate);
                        showElement(btnUpdate);
                        hideElement(btnLoading);

                        sortTable();
                    })
            })
            .catch(error => {
                setRedColor(btnUpdate);
                showElement(btnUpdate);
                hideElement(btnLoading);
                console.error(error);
            });
    }

    function requestPostBNB() {
        const btnUpdate = document.getElementById("btnUpdateBNB");
        const btnLoading = document.getElementById("btnLoadingBNB");
        if (!isExist(btnUpdate) && !isExist(btnLoading)) {
            return;
        }

        hideElement(btnUpdate);
        showElement(btnLoading);

        let urlBNB = 'https://corsproxy.io/?https://bnb.by/kursy-valyut/imbank/';
        console.log('URL for POST:', urlBNB);

        fetch(urlBNB, {
            cors: 'no-cors',
            headers: {
                'User-Agent': userAgent
            }
        })
            .then(response => {
                response.text()
                    .then(res => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(res, "text/html");
                        let rates = JSON.parse(doc.querySelector('input.jsConfig').value);

                        let rateUSD = rates['USD']['BYN']['SALE'].toFixed(4);
                        let rateEUR = rates['EUR']['BYN']['SALE'].toFixed(4);
                        let ratePLN = (1 / rates['PLN']['BYN']['SALE']).toFixed(4);

                        document.getElementById("print-BNB-USD").innerText = rateUSD;
                        document.getElementById("print-BNB-EUR").innerText = rateEUR;
                        document.getElementById("print-BNB-PLN").innerText = ratePLN;

                        setBlueColor(btnUpdate);
                        showElement(btnUpdate);
                        hideElement(btnLoading);

                        sortTable();
                    })
            })
            .catch(error => {
                setRedColor(btnUpdate);
                showElement(btnUpdate);
                hideElement(btnLoading);
                console.error(error);
            });
    }

    function requestPostAlfa() {
        const btnUpdate = document.getElementById("btnUpdateAlfa");
        const btnLoading = document.getElementById("btnLoadingAlfa");
        if (!isExist(btnUpdate) && !isExist(btnLoading)) {
            return;
        }

        hideElement(btnUpdate);
        showElement(btnLoading);

        let urlAlfa = 'https://api.codetabs.com/v1/proxy?quest=https://www.alfabank.by/exchange/digital/';
        console.log('URL for POST:', urlAlfa);

        fetch(urlAlfa, {
            cors: 'no-cors',
            headers: {
                'User-Agent': userAgent
            }
        })
            .then(response => {
                response.text()
                    .then(res => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(res, "text/html");
                        let obj = doc.querySelector('div.section-content div[data-component]');
                        let rates = JSON.parse(obj.getAttribute('data-initial'));

                        let rateUSD = Number.parseFloat(rates['initialItems']['0']['currenciesData']['0']['value']['exchangeRate']['0']['sell']['value']).toFixed(4);
                        let rateEUR = Number.parseFloat(rates['initialItems']['0']['currenciesData']['0']['value']['exchangeRate']['1']['sell']['value']).toFixed(4);

                        document.getElementById("print-Alfa-USD").innerText = rateUSD;
                        document.getElementById("print-Alfa-EUR").innerText = rateEUR;

                        setBlueColor(btnUpdate);
                        showElement(btnUpdate);
                        hideElement(btnLoading);

                        sortTable();
                    })
            })
            .catch(error => {
                setRedColor(btnUpdate);
                showElement(btnUpdate);
                hideElement(btnLoading);
                console.error(error);
            });
    }

    function requestPostParitet() {
        const btnUpdate = document.getElementById("btnUpdateParitet");
        const btnLoading = document.getElementById("btnLoadingParitet");
        if (!isExist(btnUpdate) && !isExist(btnLoading)) {
            return;
        }

        hideElement(btnUpdate);
        showElement(btnLoading);

        let urlParitet = 'https://corsproxy.io/?https://www.paritetbank.by/private/rates/';
        console.log('URL for POST:', urlParitet);

        fetch(urlParitet, {
            cors: 'no-cors',
            headers: {
                'User-Agent': userAgent
            },
            method: 'GET',
        })
            .then(response => {
                response.text()
                    .then(res => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(res, "text/html");
                        let conversion = Array.from(doc.scripts).find(s => s.innerText.includes("var conversion")).innerText;

                        let rates = JSON.parse(conversion.substring(conversion.indexOf("{"), conversion.lastIndexOf("}") + 1));
                        let rateUSD = rates['4']['USDBYN']['BUY'].toFixed(4);
                        let rateEUR = rates['4']['EURBYN']['BUY'].toFixed(4);

                        document.getElementById("print-Paritet-USD").innerText = rateUSD;
                        document.getElementById("print-Paritet-EUR").innerText = rateEUR;

                        setBlueColor(btnUpdate);
                        showElement(btnUpdate);
                        hideElement(btnLoading);

                        sortTable();
                    })
            })
            .catch(error => {
                setRedColor(btnUpdate);
                showElement(btnUpdate);
                hideElement(btnLoading);
                console.error(error);
            });
    }

    function requestPostBGPB() {
        const btnUpdate = document.getElementById("btnUpdateBGPB");
        const btnLoading = document.getElementById("btnLoadingBGPB");
        if (!isExist(btnUpdate) && !isExist(btnLoading)) {
            return;
        }

        hideElement(btnUpdate);
        showElement(btnLoading);

        let urlBGPB = 'https://corsproxy.io/?https://belgazprombank.by/about/kursi_valjut/';
        console.log('URL for POST:', urlBGPB);

        fetch(urlBGPB, {
            cors: 'no-cors',
            headers: {
                'User-Agent': userAgent
            },
            method: 'GET',
        })
            .then(response => {
                response.text()
                    .then(res => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(res, "text/html");

                        let conversionUSD = Array.from(doc.scripts).find(s => s.innerText.includes("currencyChartUSD")).innerText;
                        let conversionEUR = Array.from(doc.scripts).find(s => s.innerText.includes("currencyChartEUR")).innerText;
                        let conversionPLN = Array.from(doc.scripts).find(s => s.innerText.includes("currencyChartPLN")).innerText;

                        let objUSD = conversionUSD.substring(conversionUSD.indexOf("[["), conversionUSD.lastIndexOf("]]") + 2);
                        let objEUR = conversionEUR.substring(conversionEUR.indexOf("[["), conversionEUR.lastIndexOf("]]") + 2);
                        let objPLN = conversionPLN.substring(conversionPLN.indexOf("[["), conversionPLN.lastIndexOf("]]") + 2);

                        let jsUSD = JSON.parse(objUSD);
                        let jsEUR = JSON.parse(objEUR);
                        let jsPLN = JSON.parse(objPLN);

                        let rateUSD = (jsUSD[1][jsUSD['1']['length'] - 1]).toFixed(4);
                        let rateEUR = (jsEUR[1][jsEUR['1']['length'] - 1]).toFixed(4);
                        let ratePLN = (10 / jsPLN[1][jsPLN['1']['length'] - 1]).toFixed(4);

                        document.getElementById("print-BGPB-USD").innerText = rateUSD;
                        document.getElementById("print-BGPB-EUR").innerText = rateEUR;
                        document.getElementById("print-BGPB-PLN").innerText = ratePLN;

                        setBlueColor(btnUpdate);
                        showElement(btnUpdate);
                        hideElement(btnLoading);

                        sortTable();
                    })
            })
            .catch(error => {
                setRedColor(btnUpdate);
                showElement(btnUpdate);
                hideElement(btnLoading);
                console.error(error);
            });
    }

    function requestPostMTB() {
        const btnUpdate = document.getElementById("btnUpdateMTB");
        const btnLoading = document.getElementById("btnLoadingMTB");
        if (!isExist(btnUpdate) && !isExist(btnLoading)) {
            return;
        }

        hideElement(btnUpdate);
        showElement(btnLoading);

        let urlMTB = 'https://corsproxy.io/?https://www.mtbank.by/currxml.php';
        console.log('URL for POST:', urlMTB);

        fetch(urlMTB, {
            cors: 'no-cors',
            headers: {
                'User-Agent': userAgent
            },
            method: 'GET',
        })
            .then(response => {
                response.text()
                    .then(res => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(res, "application/xml");

                        let rateUSD;
                        let rateEUR;

                        let currencies = doc.querySelectorAll('cards currency');

                        currencies.forEach(currency => {
                            if (currency.querySelector('code').textContent === "USD" && currency.querySelector('codeTo').textContent === "BYN") {
                                rateUSD = Number.parseFloat(currency.querySelector('sale').textContent).toFixed(4);
                            }
                            if (currency.querySelector('code').textContent === "EUR" && currency.querySelector('codeTo').textContent === "BYN") {
                                rateEUR = Number.parseFloat(currency.querySelector('sale').textContent).toFixed(4);
                            }
                        });

                        document.getElementById("print-MTB-USD").innerText = rateUSD;
                        document.getElementById("print-MTB-EUR").innerText = rateEUR;

                        setBlueColor(btnUpdate);
                        showElement(btnUpdate);
                        hideElement(btnLoading);

                        sortTable();
                    })
            })
            .catch(error => {
                setRedColor(btnUpdate);
                showElement(btnUpdate);
                hideElement(btnLoading);
                console.error(error);
            });
    }

    function requestPostPayOkay() {
        const btnUpdate = document.getElementById("btnUpdatePayOkay");
        const btnLoading = document.getElementById("btnLoadingPayOkay");
        if (!isExist(btnUpdate) && !isExist(btnLoading)) {
            return;
        }

        hideElement(btnUpdate);
        showElement(btnLoading);

        let urlPayOkay = 'https://corsproxy.io/?https://www.mtbank.by/currxml.php';
        console.log('URL for POST:', urlPayOkay);

        fetch(urlPayOkay, {
            cors: 'no-cors',
            headers: {
                'User-Agent': userAgent
            },
            method: 'GET',
        })
            .then(response => {
                response.text()
                    .then(res => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(res, "application/xml");

                        let rateUSD;
                        let rateEUR;

                        let currencies = doc.querySelectorAll('payokay currency');

                        currencies.forEach(currency => {
                            if (currency.querySelector('code').textContent === "USD" && currency.querySelector('codeTo').textContent === "BYN") {
                                rateUSD = Number.parseFloat(currency.querySelector('sale').textContent).toFixed(4);
                            }
                            if (currency.querySelector('code').textContent === "EUR" && currency.querySelector('codeTo').textContent === "BYN") {
                                rateEUR = Number.parseFloat(currency.querySelector('sale').textContent).toFixed(4);
                            }
                        });

                        document.getElementById("print-PayOkay-USD").innerText = rateUSD;
                        document.getElementById("print-PayOkay-EUR").innerText = rateEUR;

                        setBlueColor(btnUpdate);
                        showElement(btnUpdate);
                        hideElement(btnLoading);

                        sortTable();
                    })
            })
            .catch(error => {
                setRedColor(btnUpdate);
                showElement(btnUpdate);
                hideElement(btnLoading);
                console.error(error);
            });
    }

    function getExchangeRates() {
        requestPostBSB();
        requestPostBNB();
        requestPostAlfa();
        requestPostParitet();
        requestPostBGPB();
        requestPostMTB();
        requestPostPayOkay();
    }

    let colNum;

    function sortTable(n) {
        let table, rows, desc, switching, i, x, y, shouldSwitch, dir, switchCount;
        table = document.getElementById("sortTable");
        switchCount = 0;
        switching = true;
        dir = "asc";
        desc = true;
        if (n === undefined || n === null) {
            if (!isExist(colNum)) {
                colNum = 0;
            }
            desc = false;
        } else {
            colNum = n;
        }

        rows = table.rows;
        for (const thElement of rows[0].getElementsByTagName("th")) {
            thElement.classList.remove("bg-success");
        }
        rows[0].getElementsByTagName("th")[colNum + 1].classList.add("bg-success");

        /* Make a loop that will continue until
        no switching has been done: */
        while (switching) {
            // Start by saying: no switching is done:
            switching = false;
            rows = table.rows;
            /* Loop through all table rows (except the
            first, which contains table headers): */
            for (i = 1; i < (rows.length - 1); i++) {
                // Start by saying there should be no switching:
                shouldSwitch = false;
                /* Get the two elements you want to compare,
                one from current row and one from the next: */
                x = rows[i].getElementsByTagName("TD")[colNum];
                y = rows[i + 1].getElementsByTagName("TD")[colNum];
                /* Check if the two rows should switch place,
                based on the direction, asc or desc: */
                let xValue = Number.parseFloat(x.innerText);
                if (isNaN(xValue)) {
                    xValue = Infinity;
                }
                let yValue = Number.parseFloat(y.innerText);
                if (isNaN(yValue)) {
                    yValue = Infinity;
                }
                if (dir === "asc") {
                    if (xValue > yValue) {
                        // If so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                } else if (dir === "desc") {
                    if (xValue < yValue) {
                        // If so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                }
            }
            if (shouldSwitch) {
                /* If a switch has been marked, make the switch
                and mark that a switch has been done: */
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                // Each time a switch is done, increase this count by 1:
                switchCount++;
            } else {
                /* If no switching has been done AND the direction is "asc",
                set the direction to "desc" and run the while loop again. */
                if (switchCount === 0 && dir === "asc" && desc) {
                    dir = "desc";
                    switching = true;
                }
            }
        }
    }

    function setBlueColor(btn) {
        if (btn.classList.contains('btn-danger'))
            btn.classList.remove('btn-danger');
        if (!btn.classList.contains('btn-info'))
            btn.classList.add('btn-info');
    }

    function setRedColor(btn) {
        if (btn.classList.contains('btn-info'))
            btn.classList.remove('btn-info');
        if (!btn.classList.contains('btn-danger'))
            btn.classList.add('btn-danger');
    }

    function showElement(el) {
        el.style.display = 'block';
    }

    function hideElement(el) {
        el.style.display = 'none';
    }

    function isExist(el) {
        return !(el === undefined || el === null)
    }

    window.onload = () => {
        console.log('onload');
        getExchangeRates();
    };
</script>

</body>
</html>